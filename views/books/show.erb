<div class="columns">
  <div class="column is-3">
    <figure class="image is-3by4 mb-5">
      <img src="<%= book_cover book %>" loading="lazy" class="cover">
    </figure>

    <% if can? :edit, book %>
      <form action="/users/<%= user.slug %>/books/<%=h book.isbn %>/shelf" method="POST">
        <input type=hidden name=authenticity_token value="<%= env['rack.session'][:csrf] %>">
        <div class="field">
          <div class="control">
            <a class="button is-fullwidth" href="/users/<%= user.slug %>/books/<%=h book.isbn %>/image">Change Cover</a>
          </div>
        </div>
        <div class="field">
          <div class="control">
            <a class="button is-fullwidth" href="/users/<%= user.slug %>/books/<%=h book.isbn %>/edit">Edit</a>
          </div>
        </div>
        <div class="field has-addons">
          <div class="control is-expanded">
            <span class="select is-fullwidth">
              <select name="shelf_id">
                <option value="" <%= 'selected' if book.shelf.nil? %>>No Shelf</option>
                <% current_user.shelves.each do |shelf| %>
                  <option value="<%= shelf.id %>" <%= 'selected' if shelf == book.shelf %>><%=h shelf.name %></option>
                <% end %>
              </select>
            </span>
          </div>

          <div class="control">
            <button class="button">Move</button>
          </div>
        </div>

        <% if can? :highlight, book %>
          <div class="field">
            <div class="control">
              <a class="button is-warning is-fullwidth" href="/users/<%= user.slug %>/books/<%=h book.isbn %>/highlights/new">
                Create Highlight
              </a>
            </div>
          </div>
        <% end %>

      </form>
    <% end %>

    <hr/>

    <div class="buttons">
      <a class="button is-fullwidth" href="https://www.amazon.de/s?k=<%=h book.isbn %>&tag=<%=h user.amazon_associates_id %>" target="_blank" rel="noopener">On Amazon.de</a>
      <a class="button is-fullwidth" href="https://www.goodreads.com/search?q=<%=h book.isbn %>" target="_blank" rel="noopener">On Goodreads.com</a>
    </div>

  </div>

  <div class="column content">
    <% if book.shelf %>
      <a class="tag is-info is-light" href="/users/<%= user.slug %>#shelf-<%= book.shelf.id %>"><%=h book.shelf.name %></a>
    <% end %>
    <h2 class="title">
      <%=h book.title %>
    </h2>

    <% if book.subtitle? %>
      <p class="subtitle">
        <%=h book.subtitle %>
      </p>
    <% end %>

    <p class="subtitle is-capitalized">
      üë§ <%=h book.author %>
    </p>

    <% if book.description? %>
      <p class="content">
        <%=h book.description %>
      </p>
    <% end %>

    <%= partial 'common/_separator' %>
    <% book.highlights.each do |highlight| %>

      <p class="has-text-centered has-text-weight-bold has-text-grey">
        ¬´ PAGE <%= highlight.page %> ¬ª
      </p>

      <p>
        <% if can? :edit, highlight %>
          <a href="/users/<%= user.slug %>/books/<%= book.isbn %>/highlights/<%= highlight.id %>/edit" class="icon is-medium">‚úèÔ∏è</a>
          <a href="/users/<%= user.slug %>/books/<%= book.isbn %>/highlights/<%= highlight.id %>/image" class="icon is-medium">üì∏</a>
        <% end %>
        <%= simple_format highlight.content %>
      </p>

        <% if highlight.image? %>
          <div class="columns">
            <div class="column"></div>
            <div class="column is-8">
              <figure class="image">
                <img src="<%= highlight.image_url %>" loading="lazy">
              </figure>
            </div>
            <div class="column"></div>
          </div>
        <% end %>

    <% end %>

  </div>
</div>
